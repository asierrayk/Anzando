#:import Factory kivy.factory.Factory
#:import App kivy.app.App

#:import AnzanManualScreen anzando
#:import AnzanFlashScreen anzando.addition_flash

<ScreenMan>:
    MainMenuScreen:

    AnzanMenuScreen:
    AnzanManualScreen:
    AnzanFlashScreen:


    DateMenuScreen:


<MenuButton@Button>:
    font_size: '32dp'

<MainMenuScreen>:
    name: 'main_menu'
    BoxLayout:
        orientation: 'vertical'
        spacing: '30dp'
        padding: '30dp'
        MenuButton:
            text: 'Anzan'
            on_release: root.manager.current = 'anzan_menu'
        MenuButton:
            text: 'Day of week'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Settings'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Quit'
            on_release: App.get_running_app().stop()

<NotImplementedPopup@Popup>:
    size_hint_x: .8
    size_hint_y: None
    height: root.width
    auto_dismiss: False
    title: 'Information'
    title_size: '30dp'
    Button:
        text: 'This feature is not implemented yet'
        text_size: self.width, self.height
        font_size: '20dp'
        halign: 'center'
        valign: 'middle'
        padding: [1,1]
        on_release: root.dismiss()

####### ANZAN #######
<KeyboardButton@Button>:
    font_size: '32dp'

<AnzanKeyboard>:
    orientation: 'vertical'
    answer: answer_display
    BoxLayout:
        size_hint_y: .2
        Label:
            id: answer_display
            text: root.answer_text
            font_size: '72dp'
            size_hint_x: .8
            multiline: False
        Button:
            text: '<-'
            size_hint_x: .2
            on_press: root.clear()
    GridLayout:
        size_hint_y: .8
        cols: 3
        spacing: '10dp'
        padding: '10dp'
        KeyboardButton:
            text: '1'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '2'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '3'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '4'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '5'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '6'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '7'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '8'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '9'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: '-'
            on_press: root.minus()
        KeyboardButton:
            text: '0'
            on_press: root.key_press(self.text)
        KeyboardButton:
            text: 'ok'
            on_press: root.ok()

<ResultButton@ButtonBehavior+BoxLayout>:

<AnzanResult>:
    orientation: 'vertical'
    ResultButton:
        on_release: root.parent.next_exercise()
        orientation: 'vertical'
        size_hint_y: 1
        Label:
            size_hint_y: .4
            background_color: 0, 0, 0, 1
            text: 'Correct!' if root.is_correct else str(root.result)
            font_size: '72dp'
        BoxLayout:
            size_hint_y: .1
            Label:
                text: "Total time"
                font_size: '30dp'
            Label:
                text: '{0:.3f}'.format(root.total_elapsed_time)
                font_size: '30dp'
        BoxLayout:
            size_hint_y: .1
            Label:
                text: "Exercise time"
                font_size: '30dp'
            Label:
                text: '{0:.3f}'.format(root.exercise_elapsed_time)
                font_size: '30dp'
        BoxLayout:
            size_hint_y: .1
            Label:
                text: "Answer time"
                font_size: '30dp'
            Label:
                text: '{0:.3f}'.format(root.answer_elapsed_time)
                font_size: '30dp'
        BoxLayout:
            size_hint_y: .1
            Label:
                text: "Current streak"
                font_size: '30dp'
            Label:
                text: str(root.current_streak)
                font_size: '30dp'
        BoxLayout:
            size_hint_y: .1
            Label:
                text: "Best streak"
                font_size: '30dp'
            Label:
                text: str(root.best_session_streak)
                font_size: '30dp'
        BoxLayout:
            size_hint_y: .1
            Label:
                text: "Success rate"
                font_size: '30dp'
            Label:
                text: str('{}/{}'.format(root.hits, root.hits+root.fails))
                font_size: '30dp'
    BoxLayout:
        size_hint_y: .1
        Button:
            font_size: '20dp'
            text: 'back'
            on_release: root.parent.go_back()
        Button:
            font_size: '20dp'
            text: 'next'
            on_release: root.parent.next_exercise()
        Button:
            font_size: '20dp'
            text: 'retry'
            on_release: root.parent.repeat_exercise()
        Button:
            font_size: '20dp'
            text: 'config'
            on_release: root.parent.show_config()

<AnzanMenuScreen>:
    name: 'anzan_menu'
    GridLayout:
        cols: 2
        spacing: '30dp'
        padding: '30dp'
        MenuButton:
            text: 'Flash'
            on_press: root.manager.current = 'play_flash_anzan'
        MenuButton:
            text: 'List'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Manual'
            on_press: root.manager.current = 'play_manual_anzan'
        MenuButton:
            text: 'Drag'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Endurance'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Multiple'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Audio'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Exam'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Back'
            on_release: root.manager.current = 'main_menu'


####### GUESS THE DAY #######

<DateMenuScreen>:
    name: 'date_menu'
    BoxLayout:
        orientation: 'vertical'
        spacing: '30dp'
        padding: '30dp'
        MenuButton:
            text: 'Play'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Back'
            on_release: root.manager.current = 'main_menu'

<SettingsMenuScreen>:
    name: 'settings_menu'
    BoxLayout:
        orientation: 'vertical'
        spacing: '30dp'
        padding: '30dp'
        MenuButton:
            text: 'My settings button'
            on_release: Factory.NotImplementedPopup().open()
        MenuButton:
            text: 'Back to menu'
            on_release: root.manager.current = 'main_menu'
